/*!
 * angular-localization :: v1.5.0 :: 2016-04-15
 * web: http://doshprompt.github.io/angular-localization
 *
 * Copyright (c) 2016 | Rahul Doshi
 * License: MIT
 */
!function(e,n,t,o){"use strict";e.module("ngLocalize.Version",[]).constant("localeVer","1.5.0"),e.module("ngLocalize",["ngSanitize","ngLocalize.Config","ngLocalize.Events","ngLocalize.InstalledLanguages"]),e.module("ngLocalize.InstalledLanguages",[]).value("localeSupported",["en-US"]).value("localeFallbacks",{en:"en-US"}),e.module("ngLocalize").service("locale",["$injector","$http","$q","$log","$rootScope","$window","localeConf","localeEvents","localeSupported","localeFallbacks",function(n,o,r,a,i,l,c,u,s,f){function g(e){return e&&e.length&&P.test(e)}function d(e){var n=e?e.split("."):"",t="";return n.length>1&&(t=n.slice(0,-1).join(".")),t}function v(e){var n=e?e.split("."):[],t="";return n.length&&(t=n[n.length-1]),t}function h(e){var n,t=null,o=e?e.split("."):[];if(o.length>1)for(t=U,n=0;n<o.length-1;n++){if(!t[o[n]]){t=null;break}t=t[o[n]]}return t}function p(e){return(Object.isFrozen||function(e){return e&&e.$$frozen})(e)}function $(e){return(Object.freeze||function(e){e&&(e.$$frozen=!0)})(e)}function m(n){var t,r,l,s=n?n.split("."):"",f=U,g=C,v=c.basePath+"/"+g;if(s.length>1){for(l=0;l<s.length-1;l++)r=s[l],f[r]||(f[r]={}),t=f,f=f[r],v+="/"+r;p(f)&&(f=e.extend({},f)),f._loading||(f._loading=!0,v+=c.fileExtension,o.get(v).success(function(e){var o,a=d(n);for(o in e)e.hasOwnProperty(o)&&(f[o]=e[o]);delete f._loading,t[r]=$(f),f=null,i.$broadcast(u.resourceUpdates,{locale:g,path:a,bundle:t[r]}),_[a]&&_[a].resolve(a)}).error(function(e){var t=d(n);a.error("[localizationService] Failed to load: "+v),delete f._loading,_[t]&&_[t].reject(e)}))}}function L(e){var n,t;return e=e||c.langFile,t=e+"._LOOKUP_",n=h(t),_[e]||(_[e]=r.defer()),n&&!n._loading?_[e].resolve(e):n||m(t),_[e].promise}function b(n){var t,o,a;if(e.isString(n))t=n.split(",");else{if(!e.isArray(n))throw new Error("locale.ready requires either an Array or comma-separated list.");t=n}return t.length>1?(a=[],t.forEach(function(e){a.push(L(e))}),o=r.all(a)):o=L(n),o}function z(n,t){var o=n,r=0;return t&&(e.isArray(t)?e.forEach(t,function(e,n){o=o.replace("%"+(n+1),e),o=o.replace("{"+(n+1)+"}",e)}):e.forEach(t,function(e,n){++r,o=o.replace("{"+n+"}",e),o=o.replace("%"+n,e),o=o.replace("%"+r,e),o=o.replace("{"+r+"}",e)})),o=o.replace(/\n/g,"<br>")}function E(n,t){var o,r,i,l="",u=!1;return e.isString(n)&&!t&&-1!==n.indexOf(c.delimiter)&&(i=n.split(c.delimiter),n=i[0],t=e.fromJson(i[1])),u=g(n),u?(e.isObject(t)||(t=[t]),o=h(n),o&&!o._loading?(r=v(n),o[r]?l=z(o[r],t):(a.info("[localizationService] Key not found: "+n),l="%%KEY_NOT_FOUND%%")):o||m(n)):l=n,l}function S(e){e=e.split("-")[0],j.attr("lang",e)}function w(n){var t=null;if(n&&n.length&&(s.forEach(function(e){return 0===e.indexOf(n)?void(t=e):void 0}),!t)){var o=f[n.split("-")[0]];e.isUndefined(o)||(t=o)}return t||c.defaultLocale}function y(n){var t;e.isString(n)&&n.length?(n=n.trim(),t=w(n)):t=c.defaultLocale,t!==C&&(U={},_={},C=t,S(t),i.$broadcast(u.localeChanges,C),x&&x.put(c.cookieName,t))}function k(){return C}function O(){var n,t,o=l.navigator,r=["language","browserLanguage","systemLanguage","userLanguage"];if(e.isArray(o.languages))for(n=0;n<o.languages.length;n++)if(t=o.languages[n])return t;for(n=0;n<r.length;n++)if(t=o[r[n]])return t;return null}function A(){y(x&&x.get(c.cookieName)?x.get(c.cookieName):O())}var C,_,U,x,P=c.validTokens||new RegExp("^[\\w\\.-]+\\.[\\w\\s\\.-]+\\w(:.*)?$"),j=e.element(t.body).parent();return c.persistSelection&&n.has("$cookieStore")&&(x=n.get("$cookieStore")),A(),{ready:b,isToken:g,getPath:d,getKey:v,setLocale:y,getLocale:k,getString:E,getPreferredBrowserLanguage:O}}]),e.module("ngLocalize").filter("i18n",["locale",function(e){var n=function(n,t){return e.getString(n,t)};return n.$stateful=!0,n}]),e.module("ngLocalize.Events",[]).constant("localeEvents",{resourceUpdates:"ngLocalizeResourcesUpdated",localeChanges:"ngLocalizeLocaleChanged"}),e.module("ngLocalize").directive("i18n",["$sce","locale","localeEvents","localeConf",function(n,t,o,r){function a(e,t){t!==e.html()&&e.html(n.getTrustedHtml(t))}function i(e,n,o){t.isToken(n)?t.ready(t.getPath(n)).then(function(){a(e,t.getString(n,o))}):a(e,n)}return function(n,t,a){var l;a.$observe("i18n",function(e,n){e&&e!==n&&i(t,e,l)}),e.forEach(a.$attr,function(e,n){r.observableAttrs.test(e)&&a.$observe(n,function(e){!e&&l&&l[n]||(l=l||{},l[n]=a[n],i(t,a.i18n,l))})}),n.$on(o.resourceUpdates,function(){i(t,a.i18n,l)}),n.$on(o.localeChanges,function(){i(t,a.i18n,l)})}}]).directive("i18nAttr",["$rootScope","locale","localeEvents",function(n,t,o){function r(e,n,t){e.$set(e.$normalize(n),t)}function a(e,n,o){var a={};return function(n){var i,l=e.$eval(n),c=[];for(var u in l)i=l[u],t.isToken(i)&&-1===c.indexOf(t.getPath(i))&&c.push(t.getPath(i));t.ready(c).then(function(){var e="";for(var n in l)i=l[n],e=t.getString(i),a[n]!==e&&(a[n]=e,r(o,n,e))})}}return{priority:1e3,compile:function(t,i){return e.forEach(n.$eval(i.i18nAttr),function(e,n){r(i,n,e||"...")}),function(e,n,t){var r=a(e,n,t);t.$observe("i18nAttr",function(e){e&&r(e)}),e.$on(o.resourceUpdates,function(){r(t.i18nAttr)}),e.$on(o.localeChanges,function(){r(t.i18nAttr)})}}}}]),e.module("ngLocalize.Config",[]).value("localeConf",{basePath:"languages",defaultLocale:"en-US",sharedDictionary:"common",fileExtension:".lang.json",persistSelection:!0,cookieName:"COOKIE_LOCALE_LANG",observableAttrs:new RegExp("^data-(?!ng-|i18n)"),delimiter:"::",validTokens:new RegExp("^[\\w\\.-]+\\.[\\w\\s\\.-]+\\w(:.*)?$")})}(this.angular,this,this.document);
//# sourceMappingURL=angular-localization.min.js.map
